{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useEffect, useState } from \"react\";\nimport { useStoreActions, useStoreState } from \"easy-peasy\";\nimport { makeStoreData } from \"../../lib/helpers/processDb.js\";\nimport NewScanForm from \"../NewScanForm/NewScanForm.js\";\nimport WebCard from \"../WebCard/WebCard.js\";\nimport NewScanInit from \"../NewScanInit/NewScanInit.js\";\nimport ModalBackground from \"../ModalBackground/ModalBackground.js\";\nimport css from \"./NewScanModal.module.css\";\nimport { slugDriver } from \"../../lib/drivers/restDrivers\";\nimport { urlRgx } from \"../../lib/helpers/regex\";\n\nconst NewScanModal = ({\n  isNew,\n  setIsNew,\n  setNewScan\n}) => {\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false);\n  const {\n    0: url,\n    1: setUrl\n  } = useState(\"\");\n  const {\n    0: slugs,\n    1: setSlugs\n  } = useState([]);\n  const {\n    scanCtgs\n  } = useStoreState(state => state);\n  const actions = useStoreActions(actions => actions);\n\n  const handleSlugs = async () => {\n    setUrl(\"\");\n    let website;\n\n    if (urlRgx.test(url)) {\n      setIsNew(false);\n      setLoading(true);\n      website = await slugDriver({\n        query: \"url=\" + url\n      });\n      actions.setScanUrl(url); // Store website metadata to local db\n\n      const storeMetaData = makeStoreData(url, actions, true);\n      website && (await storeMetaData(website.metadata));\n    }\n\n    website && actions.setMetadata(website.metadata);\n    website && setSlugs(website.slugs);\n    website && setLoading(false); // In case of errors while fetching metadata, reset the loading screen\n\n    if (!website) {\n      setIsNew(true);\n      setLoading(false);\n    }\n  }; // Cleanup function, resets all url data each tome Modal component unmounts\n\n\n  useEffect(() => () => setIsNew(true), []);\n  return /*#__PURE__*/_jsx(ModalBackground, {\n    trigger: setNewScan,\n    children: /*#__PURE__*/_jsxs(\"div\", {\n      className: css.modal,\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: \"row flex\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"three columns\",\n          children: /*#__PURE__*/_jsx(NewScanForm, {\n            url: url,\n            setUrl: setUrl,\n            slugs: slugs,\n            handleSlugs: handleSlugs\n          })\n        }), /*#__PURE__*/_jsx(WebCard, {\n          loading: loading,\n          isNew: isNew\n        })]\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"row\",\n        children: scanCtgs && /*#__PURE__*/_jsx(NewScanInit, {\n          setNewScan: setNewScan\n        })\n      })]\n    })\n  });\n};\n\nexport default NewScanModal;","map":null,"metadata":{},"sourceType":"module"}